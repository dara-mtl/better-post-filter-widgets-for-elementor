!function(e){"use strict";e(window).on("elementor/frontend/init",function(){let t="";t=e(".elementor-widget-filter-widget").length?"filter-widget":"search-bar-widget";let a=elementorModules.frontend.handlers.Base.extend({bindEvents(){this.getAjaxFilter()},getAjaxFilter(){let t=!1,a=this.$element.find(".filter-container");a.find(".bpfwe-select2 select").each(function(t){let a=e(this),i=a.closest(".bpfwe-select2");a.attr("id","bpfwe-select2-"+t).prop("multiple",!1).select2({dropdownParent:i}),i.css({visibility:"visible",opacity:"1",transition:"opacity 0.3s ease-in-out"})}),a.find(".bpfwe-multi-select2 select").each(function(t){let a=e(this),i=a.closest(".bpfwe-multi-select2");function n(){var e=i.find(".select2-selection__rendered");e.find(".select2-selection__e-plus-button").remove(),0===a.val().length&&e.prepend('<span class="select2-selection__choice select2-selection__e-plus-button">+</span>')}a.attr("id","bpfwe-multi-select2-"+t).prop("multiple",!0).select2({dropdownParent:i}),a.val(null).trigger("change"),i.css({visibility:"visible",opacity:"1",transition:"opacity 0.3s ease-in-out"}),n(),a.on("change",n)}),a.on("click","li.more",function(){var t=e(this).closest("ul.taxonomy-filter");t.hasClass("show-toggle")?t.removeClass("show-toggle"):t.addClass("show-toggle")}),e(document).on("click",".low-group-trigger",function(){var t=e(this);t.closest("li").next(".low-terms-group").toggle(),t.text("+"===t.text()?"-":"+")}),e("form.form-tax input").on("keydown",function(e){13===e.which&&e.preventDefault()});let i=window.location.href,n=window.elementorFrontendConfig.post.id,o=this.$element.data("settings");if(!o)return;let l=o.target_selector;if(!l||!l.length)return;let r=o.group_logic,s=o.dynamic_filtering,d=o.scroll_to_top,c=o.filter_post_type,f=o.nothing_found_message,p=1,m="",h=e(l),u=h.data("id"),g=h.html(),v=a.find("form").serialize(),y=h.find(".loader"),w=h.find(".pagination");w.data("max-page");var x=x||{};let b=h.data("settings");if(b&&(b.pagination||b.pagination_type)){m=b.pagination||b.pagination_type;var $,C=(b.scroll_threshold&&b.scroll_threshold.size?b.scroll_threshold.size:0)+(b.scroll_threshold&&b.scroll_threshold.unit?b.scroll_threshold.unit:"px")}else var C="0px";if(0===n||void 0===n){let _=e('div[data-elementor-type^="archive"]').first();_.length&&(n=_.data("elementor-id")),(0===n||void 0===n)&&(n=e("div[data-elementor-id]:not(header *)").first().data("elementor-id")),(0===n||void 0===n)&&(n=e("main div:first").data("elementor-id")),(0===n||void 0===n)&&(n=e('div[data-elementor-id]:not([data-elementor-type="header"])').first().data("elementor-id"))}function k(e,t){let a;return function(){let i=this,n=arguments;clearTimeout(a),a=setTimeout(()=>{e.apply(i,n)},t)}}let z=a.find(".submit-form").length>0,j=!1,I;function A(e){var t;return(t=e.includes("?page=")?e.match(/\?page=(\d+)/):e.includes("?paged=")?e.match(/\?paged=(\d+)/):e.match(/\/(\d+)(\/|$)/)?e.match(/\/(\d+)(\/|$)/):e.match(/[?&](\w+)=\d+/))||(t=e.match(/(\d+)(\/|$)/)),t?t[1]:null}function E(){let e=window.location.origin+window.location.pathname;history.replaceState(null,"",e)}function H(){let t=h.find(".post-container").data("total-post");void 0===t&&(t=0),t=Number(t),e(".filter-post-count .number").text(t)}function F(o){var p=h.find(".post-container"),w="",b="",$="",_=e("form.search-post").find("input").val(),z=new URLSearchParams(window.location.search);z.has("search")&&(_=z.get("search")),e(".form-order-by select option:selected").each(function(){var t=e(this);w=t.data("order"),$=t.data("meta"),b=t.val()}),h.removeClass("e-load-more-pagination-end"),p.addClass("load"),h.addClass("load"),(p.hasClass("shortcode")||p.hasClass("template"))&&y.fadeIn();var j=[],I=[],A=[],E=[];function P(e){return e.reduce(function(e,t){var a=e.reduce(function(e,a,i){return a.taxonomy===t.taxonomy?i:e},-1);if(a>=0)e[a].terms=e[a].terms.concat(t.terms);else{var i={taxonomy:t.taxonomy,terms:[t.terms],logic:t.logic};e=e.concat([i])}return e},[])}e(".bpfwe-taxonomy-wrapper input:checked, .bpfwe-custom-field-wrapper input:checked").each(function(){var t=e(this);(t.closest(".bpfwe-taxonomy-wrapper").length?j:I).push({taxonomy:t.data("taxonomy"),terms:t.val(),logic:t.closest("div").data("logic")})}),e(".bpfwe-custom-field-wrapper input.input-text").each(function(){var t=e(this);t.val()&&A.push({taxonomy:t.data("taxonomy"),terms:t.val(),logic:t.closest("div").data("logic")})}),e(".bpfwe-taxonomy-wrapper select option:selected, .bpfwe-custom-field-wrapper select option:selected").each(function(){var t=e(this);t.val()&&(t.closest(".bpfwe-taxonomy-wrapper").length?j:I).push({taxonomy:t.data("taxonomy"),terms:t.val(),logic:t.closest("div").data("logic")})}),e(".bpfwe-numeric-wrapper input").each(function(){var t=e(this),a=t.data("base-value");if(""===t.val()||t.val()!=a){""===t.val()&&t.val(a);var i=t.attr("class").split(" ")[0];e(".bpfwe-numeric-wrapper").find("input").each(function(){var t=e(this);t.hasClass(i)&&E.push({taxonomy:t.data("taxonomy"),terms:t.val(),logic:t.closest("div").data("logic")})})}});var D=P(j),M=P(I),T=P(A),O=P(E);e.ajax({type:"POST",url:ajax_var.url,async:!0,data:{action:"post_filter_results",widget_id:u,page_id:n,group_logic:r,search_query:_,taxonomy_output:D,dynamic_filtering:s,custom_field_output:M,custom_field_like_output:T,numeric_output:O,post_type:c,order:w,order_by:b,order_by_meta:$,paged:o,archive_type:e('[name="archive_type"]').val(),archive_post_type:e('[name="archive_post_type"]').val(),archive_taxonomy:e('[name="archive_taxonomy"]').val(),archive_id:e('[name="archive_id"]').val(),nonce:ajax_var.nonce},success:function(t){var n=JSON.parse(t).html,o=i,l=a.find("form").serialize();if("0"===t||l===v){h.off(),h.html(g).fadeIn().removeClass("load"),h.removeClass("filter-active");var r=h.data("settings");"cwm_infinite"===r.pagination_type&&(r.pagination_type="load_more_infinite_scroll",h.data("settings",r)),"cwm_ajax"===r.pagination_load_type&&(r.pagination_load_type="ajax",h.data("settings",r)),H()}else{if("infinite"==m||"load_more"==m||"load_more_on_click"==m||"load_more_infinite_scroll"==m||"cwm_infinite"==m){if(h.hasClass("filter-active")){var s=h.find(".elementor-grid").children();h.hide().empty().append(e(n)),h.find(".elementor-grid").prepend(s),h.removeClass("e-load-more-pagination-loading"),h.hasClass("elementor-widget-posts")?h.fadeIn():h.show(),h.removeClass("load")}else h.html(n).fadeIn().removeClass("load")}else h.html(n).fadeIn().removeClass("load");if(y.fadeOut(),e(n).text().trim()){var d=h.find('nav[aria-label="Pagination"]');d.addClass("pagination-filter"),d.find("a.page-numbers").each(function(){var t=e(this).attr("href");"/"===o.charAt(o.length-1)&&(o=o.slice(0,-1));var a=t.replace(/.*wp-admin\/admin-ajax\.php/,o);e(this).attr("href",a)});var c=h.find(".e-load-more-anchor"),p=c.data("next-page"),u=h.find(".load-more"),w=h.find(".elementor-button-link.elementor-button");if(u.addClass("load-more-filter"),w.addClass("load-more-filter"),h.addClass("filter-active"),void 0!==p){"/"===o.charAt(o.length-1)&&(o=o.slice(0,-1));var x=p.replace(/.*wp-admin\/admin-ajax\.php/,o);c.attr("data-next-page",x)}var r=h.data("settings");"load_more_infinite_scroll"===r.pagination_type&&(r.pagination_type="cwm_infinite",h.data("settings",r)),"ajax"===r.pagination_load_type&&(r.pagination_load_type="cwm_ajax",h.data("settings",r)),H()}else(f=f.replace(/</g,"&lt;").replace(/>/g,"&gt;"))&&f.trim().length&&h.html('<div class="no-post">'+f+"</div>")}},complete:function(){var a,i=h.find(".load-more-filter"),n=h.data("settings").pagination||h.data("settings").pagination_type,o=h.find(".e-load-more-anchor");if(o.length){var r=o.data("page");a=o.data("max-page")-1}else var r=h.find(".pagination").data("page"),a=h.find(".pagination").data("max-page")-1;"yes"==d&&window.scrollTo({top:h.offset().top-150,behavior:"smooth"}),r>a&&(h.addClass("e-load-more-pagination-end"),i.hide()),t=!1,h.hasClass("filter-active")&&"infinite"==n&&k(function(a){(function a(i,n){var o=n.find(".e-load-more-anchor"),r=e(document).find(l+" .pagination-filter a.next");if(!r.length){x[i]&&(x[i].disconnect(),x[i]=null);return}r.length&&o.length&&(x[i]||(x[i]=new IntersectionObserver(function(a){a.forEach(function(a){if(a.isIntersecting){var i=e(document).find(l+" .pagination-filter a.next");!t&&i.length&&n.hasClass("filter-active")&&(t=!0,i.click())}})},{root:null,rootMargin:C,threshold:0})),x[i].observe(o.get(0)))})(u,h)},800)(),h.hasClass("filter-active")&&"cwm_infinite"==n&&k(function(e){(function e(a,i){var n=i.find(".e-load-more-anchor"),o=n.data("page"),l=n.data("max-page");if(o===l){x[a]&&(x[a].disconnect(),x[a]=null);return}n.length&&o<l&&(x[a]||(x[a]=new IntersectionObserver(function(e){e.forEach(function(e){e.isIntersecting&&!t&&i.hasClass("filter-active")&&(t=!0,F(++o))})},{root:null,rootMargin:C,threshold:0})),x[a].observe(n.get(0)))})(u,h)},800)(),h.find("input").val(_),elementorFrontend.elementsHandler.runReadyTrigger(e(l)),elementorFrontend.config.experimentalFeatures.e_lazyload&&document.dispatchEvent(new Event("elementor/lazyload/observe")),h.removeClass("filter-initialized")},error:function(e,t,a){console.log("AJAX error: ",a)}})}a.on("mousedown keydown touchstart","form.form-tax",function(){j=!0,clearTimeout(I)}),a.on("mouseup keyup touchend","form.form-tax",function(){I=setTimeout(()=>{j=!1},700)}),a.on("change keydown input","form.form-tax, .bpfwe-numeric-wrapper input",k(function(e){if(!z){if("change"===e.type||"keydown"===e.type&&"Enter"===e.key){E(),h.addClass("filter-initialized"),h.removeClass("filter-active"),F();return}j||(E(),h.addClass("filter-initialized"),h.removeClass("filter-active"),F())}},700)),a.on("click",".submit-form",function(){return E(),h.addClass("filter-initialized"),h.removeClass("filter-active"),F(),!1}),e(document).on("change","form.form-order-by",function(){h.addClass("filter-initialized"),h.removeClass("filter-active"),F()}),e(document).off("submit","form.search-post").on("submit","form.search-post",function(){let t=e(this).attr("action");if(E(),h.addClass("filter-initialized"),h.removeClass("filter-active"),F(),t===i)return!1}),i.includes("?search=")&&F(),e(document).on("click",l+" .pagination-filter a",function(t){t.preventDefault();var a=e(this).attr("href");F(A(a))}),e(document).on("click",l+" .load-more-filter",function(t){t.preventDefault();var a=h.find(".e-load-more-anchor").data("next-page");if(a)F(A(a));else{e(document).find(l+" .pagination-filter a.next").click(),p+=1;var i=h.find(".load-more");i.text("Loading..."),i.prop("disabled",!0)}}),a.on("click",".reset-form",function(){F()}),H()}});elementorFrontend.isEditMode()?elementorFrontend.elementsHandler.attachHandler("filter-widget",a):elementorFrontend.elementsHandler.attachHandler(t,a)})}(jQuery);